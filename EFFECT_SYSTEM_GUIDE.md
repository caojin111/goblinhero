# 符号效果系统指南

## 🎮 系统概述

符号效果系统已完全实现，所有27个符号的特殊效果都能正常工作！

## ✅ 已实现的17种效果类型

### 基础效果

#### 1. `none` - 无效果
- **示例：** 玩具鸭、酒瓶
- **效果：** 只提供基础金币

#### 2. `conditional_bonus` - 条件奖励
- **示例：** 儿童
- **效果：** 如果符号池有玩具鸭，则+2金币
- **判定：** 检查符号池

#### 3. `count_bonus` - 计数奖励
- **示例：** 商人、农民
- **效果：** 每有一个指定类型符号，获得奖励
- **判定：** 统计符号池中的数量

#### 4. `mixed_count_bonus` - 混合计数
- **示例：** 野蛮人
- **效果：** 每外星人-1金币，每怪物+2金币
- **判定：** 多种类型分别计数

### 消除效果

#### 5. `eliminate_bonus` - 消除奖励
- **示例：** 士兵
- **效果：** 消除本次挖出的所有怪物，每个+50金币
- **判定：** 检查本次挖出的符号
- **行为：** 从符号池移除，棋盘不变

#### 6. `conditional_eliminate` - 条件消除
- **示例：** 手提箱、陨石
- **效果：** 遇到商人/哥莫拉时被消除，获得奖励
- **判定：** 检查符号池
- **行为：** 自己从符号池移除

#### 7. `unlock_bonus` - 解锁奖励
- **示例：** 铁钥匙、银钥匙
- **效果：** 消除对应箱子，获得奖励
- **判定：** 检查符号池
- **行为：** 从符号池移除箱子

#### 8. `universal_unlock` - 万能解锁
- **示例：** 万能钥匙
- **效果：** 消除符号池最高价值的箱子，获得2倍金币
- **判定：** 找到最贵的箱子
- **行为：** 从符号池移除

### 生成效果

#### 9. `spawn_multiple` - 批量生成
- **示例：** 号角
- **效果：** 生成5个士兵到符号池
- **行为：** 直接加入符号池

#### 10. `random_spawn` - 随机生成
- **示例：** 锄头
- **效果：** 50%概率生成花精，50%概率生成丧尸
- **行为：** 随机选择并加入符号池

#### 11. `spawn_random` - 生成随机符号
- **示例：** 精神控制器
- **效果：** 生成3个随机符号
- **行为：** 从符号库随机选择加入符号池

#### 12. `spawn_random_multiple` - 随机数量生成
- **示例：** 魔法袋
- **效果：** 生成2-5个随机符号
- **行为：** 随机数量和种类

### 特殊效果

#### 13. `infect_and_bonus` - 感染与奖励
- **示例：** 丧尸
- **效果：** 
  - 感染一个人类变成丧尸
  - 每有一个丧尸，金币+5
- **判定：** 检查符号池
- **行为：** 符号池中人类直接替换成丧尸

#### 14. `diminishing_value` - 递减价值
- **示例：** 独眼怪物
- **效果：** 第1次6金币，第2次5金币...递减到0
- **判定：** 每回合重置计数
- **行为：** 独立计数每个独眼怪物

#### 15. `random_eliminate_bonus` - 随机消除
- **示例：** 哥莫拉
- **效果：** 随机消除一个符号，获得30金币
- **判定：** 排除自己
- **行为：** 从符号池随机移除一个

#### 16. `combo_bonus` - 组合奖励
- **示例：** 光线枪、外星头盔、宇宙飞船
- **效果：** 三件套同时挖出，获得40金币
- **判定：** 检查本次挖出的符号
- **特点：** 只计算一次

#### 17. `dice_bonus` - 骰子奖励
- **示例：** 骰子一枚
- **效果：** 获得额外骰子
- **行为：** 永久增加骰子数量
- **机制：** 像大富翁，同时掷多个骰子求和

## 🎲 多骰子系统

### 工作机制

```
1个骰子: 掷1次 (1-6点)
2个骰子: 掷2次求和 (2-12点)
3个骰子: 掷3次求和 (3-18点)
...
```

### UI显示

- **1个骰子：** 🎲 "掷骰子 (1-6)"
- **2个骰子：** 🎲🎲 "掷2个骰子"
- **3个骰子：** 🎲🎲🎲 "掷3个骰子"
- **4+骰子：** 🎲🎲🎲+1 "掷4个骰子"

### 获得方式

- 挖到"骰子一枚"符号 → +1个骰子（永久）
- 每局游戏开始时重置为1个

## 📊 效果处理流程

### 处理顺序

```
1. 玩家掷骰子
   ↓
2. 挖开N个格子（N = 骰子点数总和）
   ↓
3. 收集本次挖出的符号（按格子顺序排队）
   ↓
4. 计算基础收益（符号金币值 + 相邻加成）
   ↓
5. 按队列顺序处理每个符号的效果
   ↓
6. 应用哥布林buff
   ↓
7. 显示总收益
```

### 效果执行详情

**队列处理示例：**
```
挖出：儿童 → 玩具鸭 → 商人

处理儿童：
  - 检查符号池：有玩具鸭？→ 没有
  - 奖励：0

处理玩具鸭：
  - 无效果

处理商人：
  - 检查符号池：有几个human？→ 3个（儿童、商人、之前的）
  - 奖励：+3金币
```

## 🔍 效果判定规则

### "已拥有" = 符号池
- 检查范围：底部"我的符号池"
- 包含：所有曾经选择和生成的符号
- 不包含：只在棋盘上但不在池中的

### "一起被挖起" = 本次挖出
- 检查范围：本次掷骰子挖出的所有格子
- 不包含：之前挖出的符号

### "消除" = 从符号池移除
- 符号池数量减少
- 棋盘上的符号不变
- 影响后续符号生成概率

### "感染" = 符号池替换
- 人类符号 → 丧尸符号
- 真实替换，不是临时效果
- 每次挖到丧尸都会感染一次

### "生成" = 加入符号池
- 立即加入符号池
- 影响下回合棋盘符号
- 影响其他计数效果

## 📝 日志系统

### 查看效果执行

游戏会输出详细的效果处理日志：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 [效果处理] 开始处理3个符号的效果
📋 [挖出队列] 👶儿童 → 💂士兵 → 🧟丧尸
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1/3] 🔸 处理: 👶 儿童
   ✗ 条件不满足：符号池没有玩具鸭

[2/3] 🔸 处理: 💂 士兵
   🗑️ 消除: 🧟 丧尸
   ✓ 消除1个monster，获得50金币
   💰 效果奖励: +50 金币

[3/3] 🔸 处理: 🧟 丧尸
   🧟 感染: 👨‍🌾 农民 → 🧟 丧尸
   💰 符号池有2个丧尸，获得10金币
   💰 效果奖励: +10 金币

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ [效果处理] 完成，总效果奖励: +60 金币
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 🎯 效果测试示例

### 测试1：组合效果（外星套装）

**场景：** 一次挖出光线枪、外星头盔、宇宙飞船

**预期结果：**
- 基础收益：2 + 2 + 3 = 7金币
- 组合奖励：40金币（只计算一次）
- 总计：47金币

### 测试2：感染链（丧尸）

**场景：**
- 符号池：儿童、商人、农民
- 挖到：丧尸

**预期结果：**
- 第1次挖丧尸：感染1个人类→丧尸，丧尸数量1，+5金币
- 第2次挖丧尸：感染1个人类→丧尸，丧尸数量2，+10金币
- 第3次挖丧尸：感染1个人类→丧尸，丧尸数量3，+15金币

### 测试3：消除效果（士兵）

**场景：** 一次挖出士兵、狼人、花精

**预期结果：**
- 士兵消除狼人和花精
- 符号池：士兵留在池中，狼人和花精被移除
- 奖励：50 × 2 = 100金币

### 测试4：骰子累积

**场景：**
- 第1回合：挖到"骰子一枚" → 拥有2个骰子
- 第2回合：掷2个骰子，点数求和（如3+5=8点）
- 第2回合：又挖到"骰子一枚" → 拥有3个骰子
- 第3回合：掷3个骰子

## 🐛 已知限制

### 当前版本不支持的功能

1. **巫师哥布林的魔法袋填充**
   - 需要在挖矿前生成魔法袋符号
   - 暂未实现

2. **赌徒哥布林的骰子概率翻倍**
   - 需要修改符号权重系统
   - 暂未实现

## 💡 效果交互示例

### 复杂交互1：号角 + 国王哥布林

```
1. 挖到号角 → 生成5个士兵到符号池
2. 国王哥布林buff触发 → 5个士兵 × 10金币 = +50金币
```

### 复杂交互2：丧尸感染 + 商人

```
符号池：儿童、商人、农民（3个人类）
挖出：丧尸、商人

处理丧尸：
  - 感染儿童 → 丧尸
  - 符号池：丧尸、商人、农民
  - 丧尸计数奖励：1个 × 5 = +5金币

处理商人：
  - 统计人类：2个（商人、农民）
  - 奖励：2 × 1 = +2金币
```

### 复杂交互3：独眼怪物递减

```
符号池：独眼怪物A、独眼怪物B

第1回合：
  - 挖到独眼怪物A → 第1次，6金币
  - 挖到独眼怪物B → 第1次，6金币

第2回合重置计数器

第3回合：
  - 挖到独眼怪物A → 第1次（重置后），6金币
```

## 🎨 效果可视化

游戏会在控制台输出完整的效果执行过程：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 [效果处理] 开始处理5个符号的效果
📋 [挖出队列] 👶儿童 → 🦆玩具鸭 → 💂士兵 → 🧟丧尸 → 🧑‍💼商人
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1/5] 🔸 处理: 👶 儿童
   ✗ 条件不满足：符号池没有玩具鸭

[2/5] 🔸 处理: 🦆 玩具鸭
   (无效果)

[3/5] 🔸 处理: 💂 士兵
   🗑️ 消除: 🧟 丧尸
   ✓ 消除1个monster，获得50金币
   💰 效果奖励: +50 金币

[4/5] 🔸 处理: 🧟 丧尸
   ✗ 符号池没有human可感染（已被消除）

[5/5] 🔸 处理: 🧑‍💼 商人
   ✓ 符号池有3个human，获得3金币
   💰 效果奖励: +3 金币

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ [效果处理] 完成，总效果奖励: +53 金币
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 🔧 调试技巧

### 启用/禁用效果

在 `SymbolConfig.json` 中：

```json
{
  "config": {
    "enableEffects": false  // 禁用所有符号效果
  }
}
```

### 查看符号池变化

关注日志中的：
- 🗑️ 消除符号
- 🎁 生成符号
- 🧟 感染符号
- 🔓 解锁消除

### 测试特定效果

修改符号权重，提高测试符号的出现概率：

```json
{
  "id": 26,
  "name": "骰子一枚",
  "weight": 5000  // 大幅提高权重，方便测试
}
```

## 📚 相关文档

- [符号配置完整指南](SYMBOL_CONFIG_COMPLETE_GUIDE.md)
- [哥布林配置指南](GOBLIN_CONFIG_GUIDE.md)
- [游戏设计文档](GAME_DESIGN.md)

---

**提示：** 所有效果都可以通过修改 `SymbolConfig.json` 来调整参数，无需改动代码！

